upstream frontend {
    server frontend:3000;
}

# Breed registry upstream disabled until service is implemented
# upstream breed_registry {
#     server breed-registry:8000;
# }

upstream population_analysis {
    server population-analysis:8000;
}

upstream sampling_survey {
    server sampling-survey:8000;
}

upstream genetic_diversity {
    server genetic-diversity:8004;
}

upstream species_assessment {
    server species-assessment:8005;
}

upstream habitat_landscape {
    server habitat-landscape:8006;
}

server {
    listen 80;
    server_name localhost;

    # Frontend - React App
    location / {
        proxy_pass http://frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket support for React dev server
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # API Routes
    # Breed registry routes disabled until service is implemented
    # location /api/breed-registry/ {
    #     proxy_pass http://breed_registry/;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    location /api/population-analysis/ {
        proxy_pass http://population_analysis/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/sampling-survey/ {
        proxy_pass http://sampling_survey/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/genetic-diversity/ {
        proxy_pass http://genetic_diversity/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/species-assessment/ {
        proxy_pass http://species_assessment/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/habitat-landscape/ {
        proxy_pass http://habitat_landscape/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Static and media files disabled until breed registry is implemented
    # location /static/ {
    #     proxy_pass http://breed_registry/static/;
    # }

    # location /media/ {
    #     proxy_pass http://breed_registry/media/;
    # }
}