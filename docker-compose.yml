services:
  # Database - Currently disabled, will be enabled when breed registry is implemented
  # db:
  #   image: postgres:15-alpine
  #   environment:
  #     POSTGRES_DB: breed_registry
  #     POSTGRES_USER: conservation_user
  #     POSTGRES_PASSWORD: conservation_pass
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   ports:
  #     - "5432:5432"

  # Redis for caching and task queue - Currently disabled, will be enabled when needed
  # redis:
  #   image: redis:7-alpine
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis_data:/data

  # Breed Registry - Django Service - Currently disabled, will be implemented last
  # breed-registry:
  #   build:
  #     context: ./services/breed-registry
  #     dockerfile: Dockerfile
  #   ports:
  #     - "8001:8000"
  #   volumes:
  #     - ./services/breed-registry:/app
  #   environment:
  #     - POSTGRES_DB=breed_registry
  #     - POSTGRES_USER=conservation_user
  #     - POSTGRES_PASSWORD=conservation_pass
  #     - DB_HOST=db
  #     - DEBUG=1
  #   depends_on:
  #     - db
  #     - redis

  # Population Analysis - FastAPI Service
  population-analysis:
    build:
      context: ./services/population-analysis
      dockerfile: Dockerfile
    ports:
      - "8002:8000"
    volumes:
      - ./services/population-analysis:/app
    # Redis dependency removed until breed registry is implemented
    # environment:
    #   - REDIS_URL=redis://redis:6379/1

  # Sampling & Survey Design - FastAPI Service
  sampling-survey:
    build:
      context: ./services/sampling-survey
      dockerfile: Dockerfile
    ports:
      - "8003:8000"
    volumes:
      - ./services/sampling-survey:/app

  # Genetic Diversity - FastAPI Service
  genetic-diversity:
    build:
      context: ./services/genetic-diversity
      dockerfile: Dockerfile
    ports:
      - "8004:8004"
    volumes:
      - ./services/genetic-diversity:/app

  # Species Assessment - FastAPI Service
  species-assessment:
    build:
      context: ./services/species-assessment
      dockerfile: Dockerfile
    ports:
      - "8005:8005"
    volumes:
      - ./services/species-assessment:/app

  # Habitat & Landscape - FastAPI Service
  habitat-landscape:
    build:
      context: ./services/habitat-landscape
      dockerfile: Dockerfile
    ports:
      - "8006:8006"
    volumes:
      - ./services/habitat-landscape:/app

  # Climate Impact Assessment - FastAPI Service
  climate-impact:
    build:
      context: ./services/climate-impact
      dockerfile: Dockerfile
    ports:
      - "8007:8007"
    volumes:
      - ./services/climate-impact:/app

  # Conservation Planning - FastAPI Service
  conservation-planning:
    build:
      context: ./services/conservation-planning
      dockerfile: Dockerfile
    ports:
      - "8008:8008"
    volumes:
      - ./services/conservation-planning:/app

  # Frontend - React App
  frontend:
    build: 
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      - population-analysis
      - sampling-survey
      - genetic-diversity
      - species-assessment
      - habitat-landscape
      - climate-impact
      - conservation-planning
      # - breed-registry  # Disabled until breed registry is implemented

  # Reverse Proxy
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./deployment/nginx/development.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      # - breed-registry  # Disabled until breed registry is implemented
      - population-analysis
      - sampling-survey
      - genetic-diversity
      - species-assessment
      - habitat-landscape
      - climate-impact
      - conservation-planning
      - frontend

# Volumes disabled until breed registry is implemented
# volumes:
#   postgres_data:
#   redis_data: